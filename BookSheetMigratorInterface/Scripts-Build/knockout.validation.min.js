/*=============================================================================
	Author:			Eric M. Barnard - @ericmbarnard								
	License:		MIT (http://opensource.org/licenses/mit-license.php)		
																				
	Description:	Validation Library for KnockoutJS							
	Version:		2.0.3											
===============================================================================
*/

!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.validation={})}(function(e,t){function n(e){var t="max"===e;return function(n,r){if(s.utils.isEmptyVal(n))return!0;var i,o;void 0===r.typeAttr?(o="text",i=r):(o=r.typeAttr,i=r.value),isNaN(i)||i instanceof Date||(o="number");var u,a,f;switch(o.toLowerCase()){case"week":if(u=/^(\d{4})-W(\d{2})$/,a=n.match(u),null===a)throw new Error("Invalid value for "+e+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");return f=i.match(u),f?t?a[1]<f[1]||a[1]===f[1]&&a[2]<=f[2]:a[1]>f[1]||a[1]===f[1]&&a[2]>=f[2]:!1;case"month":if(u=/^(\d{4})-(\d{2})$/,a=n.match(u),null===a)throw new Error("Invalid value for "+e+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");return f=i.match(u),f?t?a[1]<f[1]||a[1]===f[1]&&a[2]<=f[2]:a[1]>f[1]||a[1]===f[1]&&a[2]>=f[2]:!1;case"number":case"range":return t?!isNaN(n)&&parseFloat(n)<=parseFloat(i):!isNaN(n)&&parseFloat(n)>=parseFloat(i);default:return t?i>=n:n>=i}}}function r(e,t,n){return t.validator(e(),void 0===n.params?!0:u(n.params))?!0:(e.setError(s.formatMessage(n.message||t.message,u(n.params),e)),!1)}function i(e,t,n){e.isValidating(!0);var r=function(r){var i=!1,o="";return e.__valid__()?(r.message?(i=r.isValid,o=r.message):i=r,i||(e.error(s.formatMessage(o||n.message||t.message,u(n.params),e)),e.__valid__(i)),void e.isValidating(!1)):void e.isValidating(!1)};s.utils.async(function(){t.validator(e(),void 0===n.params?!0:u(n.params),r)})}if("undefined"==typeof e)throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in");e.validation=t;var s=e.validation,o=e.utils,u=o.unwrapObservable,a=o.arrayForEach,f=o.extend,l={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},c=f({},l);c.html5Attributes=["required","pattern","min","max","step"],c.html5InputTypes=["email","number","date"],c.reset=function(){f(c,l)},s.configuration=c,s.utils=function(){var e=(new Date).getTime(),t={},n="__ko_validation__";return{isArray:function(e){return e.isArray||"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return null!==e&&"object"==typeof e},isNumber:function(e){return!isNaN(e)},isObservableArray:function(e){return!!e&&"function"==typeof e.remove&&"function"==typeof e.removeAll&&"function"==typeof e.destroy&&"function"==typeof e.destroyAll&&"function"==typeof e.indexOf&&"function"==typeof e.replace},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},getValue:function(e){return"function"==typeof e?e():e},hasAttribute:function(e,t){return null!==e.getAttribute(t)},getAttribute:function(e,t){return e.getAttribute(t)},setAttribute:function(e,t,n){return e.setAttribute(t,n)},isValidatable:function(e){return!!(e&&e.rules&&e.isValid&&e.isModified)},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return e+=1},getConfigOptions:function(e){var t=s.utils.contextFor(e);return t||s.configuration},setDomData:function(e,r){var i=e[n];i||(e[n]=i=s.utils.newId()),t[i]=r},getDomData:function(e){var r=e[n];return r?t[r]:void 0},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=s.utils.getDomData(e);if(t)return t;if(e.parentNode)return s.utils.contextFor(e.parentNode)}return void 0},isEmptyVal:function(e){return void 0===e?!0:null===e?!0:""===e?!0:void 0},getOriginalElementTitle:function(e){var t=s.utils.getAttribute(e,"data-orig-title"),n=e.title,r=s.utils.hasAttribute(e,"data-orig-title");return r?t:n},async:function(e){window.setImmediate?window.setImmediate(e):window.setTimeout(e,0)},forEach:function(e,t){if(s.utils.isArray(e))return a(e,t);for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}}}();var h=function(){function t(e){a(e.subscriptions,function(e){e.dispose()}),e.subscriptions=[]}function n(e){e.options.deep&&(a(e.flagged,function(e){delete e.__kv_traversed}),e.flagged.length=0),e.options.live||t(e)}function r(e,r){r.validatables=[],t(r),i(e,r),n(r)}function i(t,n,r){var s=[],o=t.peek?t.peek():t;t.__kv_traversed!==!0&&(n.options.deep&&(t.__kv_traversed=!0,n.flagged.push(t)),r=void 0!==r?r:n.options.deep?1:-1,e.isObservable(t)&&(t.errors||p.isValidatable(t)||t.extend({validatable:!0}),n.validatables.push(t),n.options.live&&p.isObservableArray(t)&&n.subscriptions.push(t.subscribe(function(){n.graphMonitor.valueHasMutated()}))),o&&!o._destroy&&(p.isArray(o)?s=o:p.isObject(o)&&(s=p.values(o))),0!==r&&p.forEach(s,function(t){!t||t.nodeType||e.isComputed(t)&&!t.rules||i(t,n,r+1)}))}function l(e){var t=[];return a(e,function(e){p.isValidatable(e)&&!e.isValid()&&t.push(e.error.peek())}),t}var c=0,h=s.configuration,p=s.utils;return{init:function(e,t){c>0&&!t||(e=e||{},e.errorElementClass=e.errorElementClass||e.errorClass||h.errorElementClass,e.errorMessageClass=e.errorMessageClass||e.errorClass||h.errorMessageClass,f(h,e),h.registerExtenders&&s.registerExtenders(),c=1)},reset:s.configuration.reset,group:function(t,n){n=f(f({},h.grouping),n);var i={options:n,graphMonitor:e.observable(),flagged:[],subscriptions:[],validatables:[]},s=null;return s=n.observable?e.computed(function(){return i.graphMonitor(),r(t,i),l(i.validatables)}):function(){return r(t,i),l(i.validatables)},s.showAllMessages=function(e){void 0===e&&(e=!0),s.forEach(function(t){p.isValidatable(t)&&t.isModified(e)})},s.isAnyMessageShown=function(){var e;return e=!!s.find(function(e){return p.isValidatable(e)&&!e.isValid()&&e.isModified()})},s.filter=function(e){return e=e||function(){return!0},s(),o.arrayFilter(i.validatables,e)},s.find=function(e){return e=e||function(){return!0},s(),o.arrayFirst(i.validatables,e)},s.forEach=function(e){e=e||function(){},s(),a(i.validatables,e)},s.map=function(e){return e=e||function(e){return e},s(),o.arrayMap(i.validatables,e)},s._updateState=function(e){if(!p.isObject(e))throw new Error("An object is required.");return t=e,n.observable?void i.graphMonitor.valueHasMutated():(r(e,i),l(i.validatables))},s},formatMessage:function(e,t,n){if(p.isObject(t)&&t.typeAttr&&(t=t.value),"function"==typeof e)return e(t,n);var r=u(t);return null==r&&(r=[]),p.isArray(r)||(r=[r]),e.replace(/{(\d+)}/gi,function(e,t){return"undefined"!=typeof r[t]?r[t]:e})},addRule:function(e,t){e.extend({validatable:!0});var n=!!o.arrayFirst(e.rules(),function(e){return e.rule&&e.rule===t.rule});return n||e.rules.push(t),e},addAnonymousRule:function(e,t){void 0===t.message&&(t.message="Error"),t.onlyIf&&(t.condition=t.onlyIf),s.addRule(e,t)},addExtender:function(t){e.extenders[t]=function(e,n){return n&&(n.message||n.onlyIf)?s.addRule(e,{rule:t,message:n.message,params:p.isEmptyVal(n.params)?!0:n.params,condition:n.onlyIf}):s.addRule(e,{rule:t,params:n})}},registerExtenders:function(){if(h.registerExtenders)for(var t in s.rules)s.rules.hasOwnProperty(t)&&(e.extenders[t]||s.addExtender(t))},insertValidationMessage:function(e){var t=document.createElement("SPAN");return t.className=p.getConfigOptions(e).errorMessageClass,p.insertAfter(e,t),t},parseInputValidationAttributes:function(e,t){a(s.configuration.html5Attributes,function(n){if(p.hasAttribute(e,n)){var r=e.getAttribute(n)||!0;if("min"===n||"max"===n){var i=e.getAttribute("type");"undefined"!=typeof i&&i||(i="text"),r={typeAttr:i,value:r}}s.addRule(t(),{rule:n,params:r})}});var n=e.getAttribute("type");a(s.configuration.html5InputTypes,function(e){e===n&&s.addRule(t(),{rule:"date"===e?"dateISO":e,params:!0})})},writeInputValidationAttributes:function(t,n){var r=n();if(r&&r.rules){var i=r.rules();a(s.configuration.html5Attributes,function(n){var r=o.arrayFirst(i,function(e){return e.rule&&e.rule.toLowerCase()===n.toLowerCase()});r&&e.computed({read:function(){var i=e.unwrap(r.params);"pattern"===r.rule&&i instanceof RegExp&&(i=i.source),t.setAttribute(n,i)},disposeWhenNodeIsRemoved:t})}),i=null}},makeBindingHandlerValidatable:function(t){var n=e.bindingHandlers[t].init;e.bindingHandlers[t].init=function(t,r,i,s,o){return n(t,r,i,s,o),e.bindingHandlers.validationCore.init(t,r,i,s,o)}},setRules:function(t,n){var r=function(t,n){if(t&&n)for(var i in n)if(n.hasOwnProperty(i)){var o=n[i];if(t[i]){var a=t[i],f=u(a),l={},c={};for(var h in o)o.hasOwnProperty(h)&&(s.rules[h]?l[h]=o[h]:c[h]=o[h]);if(e.isObservable(a)&&a.extend(l),f&&p.isArray(f))for(var d=0;d<f.length;d++)r(f[d],c);else r(f,c)}}};r(t,n)}}}();f(e.validation,h),s.rules={},s.rules.required={validator:function(e,t){var n;return void 0===e||null===e?!t:(n=e,"string"==typeof e&&(n=String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")),t?(n+"").length>0:!0)},message:"This field is required."},s.rules.min={validator:n("min"),message:"Please enter a value greater than or equal to {0}."},s.rules.max={validator:n("max"),message:"Please enter a value less than or equal to {0}."},s.rules.minLength={validator:function(e,t){if(s.utils.isEmptyVal(e))return!0;var n=s.utils.isNumber(e)?""+e:e;return n.length>=t},message:"Please enter at least {0} characters."},s.rules.maxLength={validator:function(e,t){if(s.utils.isEmptyVal(e))return!0;var n=s.utils.isNumber(e)?""+e:e;return n.length<=t},message:"Please enter no more than {0} characters."},s.rules.pattern={validator:function(e,t){return s.utils.isEmptyVal(e)||null!==e.toString().match(t)},message:"Please check this value."},s.rules.step={validator:function(e,t){if(s.utils.isEmptyVal(e)||"any"===t)return!0;var n=100*e%(100*t);return Math.abs(n)<1e-5||Math.abs(1-n)<1e-5},message:"The value must increment by {0}."},s.rules.email={validator:function(e,t){return t?s.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e):!0},message:"Please enter a proper email address."},s.rules.date={validator:function(e,t){return t?s.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e)):!0},message:"Please enter a proper date."},s.rules.dateISO={validator:function(e,t){return t?s.utils.isEmptyVal(e)||t&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(e):!0},message:"Please enter a proper date."},s.rules.number={validator:function(e,t){return t?s.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e):!0},message:"Please enter a number."},s.rules.digit={validator:function(e,t){return t?s.utils.isEmptyVal(e)||t&&/^\d+$/.test(e):!0},message:"Please enter a digit."},s.rules.phoneUS={validator:function(e,t){return t?s.utils.isEmptyVal(e)?!0:"string"!=typeof e?!1:(e=e.replace(/\s+/g,""),t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number."},s.rules.equal={validator:function(e,t){var n=t;return e===s.utils.getValue(n)},message:"Values must equal."},s.rules.notEqual={validator:function(e,t){var n=t;return e!==s.utils.getValue(n)},message:"Please choose another value."},s.rules.unique={validator:function(e,t){var n=s.utils.getValue(t.collection),r=s.utils.getValue(t.externalValue),i=0;return e&&n?(o.arrayFilter(n,function(n){e===(t.valueAccessor?t.valueAccessor(n):n)&&i++}),(r?1:2)>i):!0},message:"Please make sure the value is unique."},function(){s.registerExtenders()}(),e.bindingHandlers.validationCore=function(){return{init:function(t,n){var r=s.utils.getConfigOptions(t),i=n();if(r.parseInputAttributes&&s.utils.async(function(){s.parseInputValidationAttributes(t,n)}),r.insertMessages&&s.utils.isValidatable(i)){var o=s.insertValidationMessage(t);r.messageTemplate?e.renderTemplate(r.messageTemplate,{field:i},null,o,"replaceNode"):e.applyBindingsToNode(o,{validationMessage:i})}r.writeInputAttributes&&s.utils.isValidatable(i)&&s.writeInputValidationAttributes(t,n),r.decorateInputElement&&s.utils.isValidatable(i)&&e.applyBindingsToNode(t,{validationElement:i})}}}(),s.makeBindingHandlerValidatable("value"),s.makeBindingHandlerValidatable("checked"),e.bindingHandlers.textInput&&s.makeBindingHandlerValidatable("textInput"),s.makeBindingHandlerValidatable("selectedOptions"),e.bindingHandlers.validationMessage={update:function(t,n){var r=n(),i=s.utils.getConfigOptions(t),a=(u(r),!1),f=!1;if(null===r||"undefined"==typeof r)throw new Error("Cannot bind validationMessage to undefined value. data-bind expression: "+t.getAttribute("data-bind"));a=r.isModified&&r.isModified(),f=r.isValid&&r.isValid();var l=null;(!i.messagesOnModified||a)&&(l=f?null:r.error);var c=!i.messagesOnModified||a?!f:!1,h="none"!==t.style.display;i.allowHtmlMessages?o.setHtml(t,l):e.bindingHandlers.text.update(t,function(){return l}),h&&!c?t.style.display="none":!h&&c&&(t.style.display="")}},e.bindingHandlers.validationElement={update:function(t,n,r){var i=n(),o=s.utils.getConfigOptions(t),a=(u(i),!1),f=!1;if(null===i||"undefined"==typeof i)throw new Error("Cannot bind validationElement to undefined value. data-bind expression: "+t.getAttribute("data-bind"));a=i.isModified&&i.isModified(),f=i.isValid&&i.isValid();var l=function(){var e={},t=!o.decorateElementOnModified||a?!f:!1;return e[o.errorElementClass]=t,e};e.bindingHandlers.css.update(t,l,r),o.errorsAsTitle&&e.bindingHandlers.attr.update(t,function(){var e=!o.errorsAsTitleOnModified||a,n=s.utils.getOriginalElementTitle(t);return e&&!f?{title:i.error,"data-orig-title":n}:!e||f?{title:n,"data-orig-title":null}:void 0})}},e.bindingHandlers.validationOptions=function(){return{init:function(e,t){var n=u(t());if(n){var r=f({},s.configuration);f(r,n),s.utils.setDomData(e,r)}}}}(),e.extenders.validation=function(e,t){return a(s.utils.isArray(t)?t:[t],function(t){s.addAnonymousRule(e,t)}),e},e.extenders.validatable=function(t,n){if(s.utils.isObject(n)||(n={enable:n}),"enable"in n||(n.enable=!0),n.enable&&!s.utils.isValidatable(t)){var r=s.configuration.validate||{},i={throttleEvaluation:n.throttle||r.throttle};t.error=e.observable(null),t.rules=e.observableArray(),t.isValidating=e.observable(!1),t.__valid__=e.observable(!0),t.isModified=e.observable(!1),t.isValid=e.computed(t.__valid__),t.setError=function(e){var n=t.error.peek(),r=t.__valid__.peek();t.error(e),t.__valid__(!1),n===e||r||t.isValid.notifySubscribers()},t.clearError=function(){return t.error(null),t.__valid__(!0),t};var o=t.subscribe(function(){t.isModified(!0)}),u=e.computed(f({read:function(){return t(),t.rules(),s.validateObservable(t),!0}},i));f(u,i),t._disposeValidation=function(){t.isValid.dispose(),t.rules.removeAll(),o.dispose(),u.dispose(),delete t.rules,delete t.error,delete t.isValid,delete t.isValidating,delete t.__valid__,delete t.isModified,delete t.setError,delete t.clearError,delete t._disposeValidation}}else n.enable===!1&&t._disposeValidation&&t._disposeValidation();return t},s.validateObservable=function(e){for(var t,n,o=0,u=e.rules(),a=u.length;a>o;o++)if(n=u[o],!n.condition||n.condition())if(t=n.rule?s.rules[n.rule]:n,t.async||n.async)i(e,t,n);else if(!r(e,t,n))return!1;return e.clearError(),!0};var p,d={};s.defineLocale=function(e,t){return e&&t?(d[e.toLowerCase()]=t,t):null},s.locale=function(e){if(e){if(e=e.toLowerCase(),!d.hasOwnProperty(e))throw new Error("Localization "+e+" has not been loaded.");s.localize(d[e]),p=e}return p},s.localize=function(e){var t=s.rules;for(var n in e)t.hasOwnProperty(n)&&(t[n].message=e[n])},function(){var e={},t=s.rules;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n].message);s.defineLocale("en-us",e)}(),p="en-us",e.applyBindingsWithValidation=function(t,n,r){var i,o=document.body;n&&n.nodeType?(o=n,i=r):i=n,s.init(),i&&(i=f(f({},s.configuration),i),s.utils.setDomData(o,i)),e.applyBindings(t,o)};var v=e.applyBindings;e.applyBindings=function(e,t){s.init(),v(e,t)},e.validatedObservable=function(t,n){if(!n&&!s.utils.isObject(t))return e.observable(t).extend({validatable:!0});var r=e.observable(t);return r.errors=s.group(s.utils.isObject(t)?t:{},n),r.isValid=e.observable(0===r.errors().length),e.isObservable(r.errors)?r.errors.subscribe(function(e){r.isValid(0===e.length)}):e.computed(r.errors).subscribe(function(e){r.isValid(0===e.length)}),r.subscribe(function(e){s.utils.isObject(e)||(e={}),r.errors._updateState(e),r.isValid(0===r.errors().length)}),r}});