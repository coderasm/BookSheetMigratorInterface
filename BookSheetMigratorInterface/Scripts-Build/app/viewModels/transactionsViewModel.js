define(["knockout","app/viewModels/transactionViewModel","app/viewModels/bulkUpdateAjaxOperation","app/viewModels/bulkImportAjaxOperation","app/bindings/isLoadingWhen","app/bindings/pagination","app/utilities/utilities","signalr.hubs"],function(e,t,n,r){return function(){function o(){return e.utils.arrayFilter(s.transactions(),function(e){return e.isSelected()})}function a(){u.server.getUnimported().done(function(e){var n=$.map(e.unimported,function(e){return new t(e,s.transactionUri)});s.isLoadingTransactions(!1),s.feeExceptions=e.feeExceptions,s.transactions(n)}).fail(function(e,t,n){s.error(n)})}var s=this;s.transactions=e.observableArray([]),s.error=e.observable(),s.hasTransactions=e.computed(function(){return s.transactions().length>0}),s.transactionUri="/api/Transaction/",s.feeExceptions=[],s.filter=e.observable(""),s.showOnlyNew=e.observable(!1),s.isNotImporting=e.observable(!0),s.filteredTransactions=e.computed(function(){var t=s.filter().toLowerCase();if(!t&&!s.showOnlyNew())return s.transactions();var n=s.transactions();return s.showOnlyNew()&&(n=e.utils.arrayFilter(n,function(e){return e.newlyAdded()})),t&&(n=e.utils.arrayFilter(n,function(e){return e.vin.toLowerCase().contains(t)})),n}),s.toggleShowOnlyNew=function(){s.showOnlyNew(!s.showOnlyNew())},s.showOnlyNew=e.observable(!1),s.newCount=e.computed(function(){var t=e.utils.arrayFilter(s.transactions(),function(e){return e.newlyAdded()});return t.length}),s.filterTypeCount=e.computed(function(){return s.showOnlyNew()?s.transactions().length:s.newCount()}),s.filterTypeText=e.computed(function(){return s.showOnlyNew()?"All":"New"}),s.hasNew=e.computed(function(){return s.newCount()>0}),s.isLoadingTransactions=e.observable(!0),s.itemCount=e.computed(function(){return s.filteredTransactions().length}),s.perPage=e.observable(10),s.pageIndex=e.observable(0),s.page=e.computed(function(){var e=s.pageIndex()*s.perPage();return s.filteredTransactions().slice(e,e+s.perPage())}),s.fadeIn=function(e){$(e).hide(),$(e).fadeIn(250)},s.selectAll=function(){e.utils.arrayForEach(s.page(),function(e){e.isSelected(!0)})},s.selectNone=function(){e.utils.arrayForEach(s.page(),function(e){e.isSelected(!1)})},s.importSelected=function(){var e=o(),t=new r(e,s);t.execute()},s.showImportMessagesAndRemove=function(e){e.forEach(function(e){s.transactions().some(function(t){return t.equals(e)?(t.showImportResultAndRemove(e.result,s.transactions),!0):!1})})},s.updateSelected=function(){var e=o(),t=new n(e,s);t.execute()},s.showUpdateMessages=function(e){e.forEach(function(e){s.transactions().some(function(t){return t.equals(e)?(t.showUpdateResult(e.result),!0):!1})})};var u=$.connection.transactionTicker;u.client.consumeNewTransactions=function(e){$.each(e,function(e,n){var r=new t(n,s.transactionUri);r.newlyAdded(!0),s.transactions.push(r)})},$.connection.hub.logging=!0,$.connection.hub.start().done(a)}});