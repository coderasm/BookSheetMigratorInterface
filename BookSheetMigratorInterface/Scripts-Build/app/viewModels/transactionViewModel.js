define(["knockout","app/bindings/dateTimePicker","app/utilities/utilities","app/extenders/changeTracking","kovalidation","app/configurations/validation"],function(e){return function(n,r){function s(){for(key in i)i.hasOwnProperty(key)&&e.isObservable(i[key])&&typeof i[key].isDirty=="function"&&i[key].isDirty()&&(i[key](i[key].originalValue),i[key].isDirty(!1))}function o(e){return e.eventId=i.eventId,e.transactionId=i.transactionId,e}function u(){for(key in i)i.hasOwnProperty(key)&&e.isObservable(i[key])&&typeof i[key].isDirty=="function"&&i[key].isDirty()&&(i[key].originalValue=i[key](),i[key].isDirty(!1))}function a(){l()}function f(){i.buyerContactId(null)}function l(){i.buyers().every(function(e){return e.dealerId===i.buyerDealerId()?(i.buyerContacts(e.contacts),!1):!0})}var i=this;i.eventId=n.eventId,i.transactionId=n.transactionId,i.bidAmount=e.observable(n.bidAmount).extend({trackChange:!0,required:!0,min:1e3,message:"Must be >= 1000"}),i.soldDate=e.observable(n.soldDate).extend({trackChange:!0}),i.sellerDmvNumber=n.sellerDmvNumber,i.sellerDealerId=e.observable(n.sellerDealerId).extend({trackChange:!0}),i.sellerCompanyName=n.sellerCompanyName,i.sellerPhone=n.sellerPhone,i.sellerAddress=n.sellerAddress,i.sellerCity=n.sellerCity,i.buyerDmvNumber=n.buyerDmvNumber,i.buyerDealerId=e.observable(n.buyerDealerId).extend({trackChange:!0}),i.buyerContactId=e.observable(n.buyerContactId).extend({trackChange:!0}),i.buyerCompanyName=n.buyerCompanyName,i.buyerPhone=n.buyerPhone,i.buyerAddress=n.buyerAddress,i.buyerCity=n.buyerCity,i.transportFee=e.observable(n.transportFee).extend({trackChange:!0,required:!0,min:0,message:"Must be >= 0"}),i.mileage=n.mileage,i.make=n.make,i.model=n.model,i.vin=n.vin,i.year=n.year,i.sellers=e.observableArray(n.sellers),i.buyers=e.observableArray(n.buyers),i.buyerContacts=e.observableArray([]),i.buyerDealerId.subscribe(function(){l(),f()}),i.error=e.observable(""),i.hasError=e.computed(function(){return i.error()!==""}),i.success=e.observable(""),i.hasSuccess=e.computed(function(){return i.success()!==""}),i.isDirty=e.computed(function(){for(key in i)if(i.hasOwnProperty(key)&&e.isObservable(i[key])&&typeof i[key].isDirty=="function"&&i[key].isDirty())return!0;return!1}),i.contactNameTitle=function(t){return t.name+" - "+t.title},i.clearChanges=function(){s()},i.importable=e.computed(function(){return i.sellerDealerId()!=null&&i.buyerDealerId()!=null&&i.buyerContactId()!=null&&i.bidAmount()>=1e3&&i.transportFee()>=0&&!i.isDirty()}),i.updateable=e.computed(function(){return i.bidAmount()>=1e3&&i.transportFee()>=0}),i.updateSale=function(){i.error("");if(!i.isDirty()){i.error("Nothing to update.");return}if(!i.updateable()){i.error("Fix your errors.");return}var e={sellerDealerId:i.sellerDealerId(),buyerDealerId:i.buyerDealerId(),buyerContactId:i.buyerContactId(),bidAmount:i.bidAmount(),transportFee:i.transportFee(),soldDate:i.soldDate()};e=o(e),$.ajax({url:r+"update/"+e.eventId+"/"+e.transactionId,type:"POST",data:e,dataType:"json",success:function(e){i.error(""),e.success?(u(),i.success("Update Successful")):i.error("Update Not Successful")}})},i.importSale=function(e){var t=$(e).formToJSON();t=o(t),$.ajax({url:r+"import",type:"POST",data:t,dataType:"json",success:function(e){e.success?i.success("Import Successful"):i.success("Import Not Successful")}})},a()}});