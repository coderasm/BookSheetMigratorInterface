define(["knockout","app/bindings/dateTimePicker","app/utilities/utilities","app/extenders/changeTracking","kovalidation","app/configurations/validation"],function(e){return function(n,r){function s(){i.success(""),i.error("")}function o(){for(key in i){var t=i[key];i.hasOwnProperty(key)&&e.isObservable(t)&&typeof t.isDirty=="function"&&t.isDirty()&&(t(t.originalValue),t.isDirty(!1))}}function u(){for(key in i){var t=i[key];i.hasOwnProperty(key)&&e.isObservable(t)&&typeof t.isDirty=="function"&&t.isDirty()&&(t.originalValue=t(),t.isDirty(!1))}}function a(){l()}function f(){i.buyerContactId(null)}function l(){i.buyers().every(function(e){return e.dealerId===i.buyerDealerId()?(i.buyerContacts(e.contacts),!1):!0})}var i=this;i.eventId=n.eventId,i.transactionId=n.transactionId,i.bidAmount=e.observable(n.bidAmount).extend({trackChange:!0,required:!0,min:1e3}),i.soldDate=e.observable(n.soldDate).extend({trackChange:!0}),i.sellerDmvNumber=n.sellerDmvNumber,i.sellerDealerId=e.observable(n.sellerDealerId).extend({trackChange:!0}),i.sellerCompanyName=n.sellerCompanyName,i.sellerPhone=n.sellerPhone,i.sellerAddress=n.sellerAddress,i.sellerCity=n.sellerCity,i.buyerDmvNumber=n.buyerDmvNumber,i.buyerDealerId=e.observable(n.buyerDealerId).extend({trackChange:!0}),i.buyerContactId=e.observable(n.buyerContactId).extend({trackChange:!0}),i.buyerCompanyName=n.buyerCompanyName,i.buyerPhone=n.buyerPhone,i.buyerAddress=n.buyerAddress,i.buyerCity=n.buyerCity,i.transportFee=e.observable(n.transportFee).extend({trackChange:!0,required:!0,min:0}),i.mileage=n.mileage,i.make=n.make,i.model=n.model,i.vin=n.vin,i.year=n.year,i.sellers=e.observableArray(n.sellers),i.buyers=e.observableArray(n.buyers),i.buyerContacts=e.observableArray([]),i.buyerDealerId.subscribe(function(){l(),f()}),i.isImported=n.imported!=null,i.isSelected=e.observable(!1),i.error=e.observable(""),i.hasError=e.computed(function(){return i.error()!==""}),i.success=e.observable(""),i.hasSuccess=e.computed(function(){return i.success()!==""}),i.isDirty=e.computed(function(){for(key in i){var t=i[key];if(i.hasOwnProperty(key)&&e.isObservable(t)&&typeof t.isDirty=="function"&&t.isDirty())return!0}return!1}),i.contactNameTitle=function(t){return t.name+" - "+t.title},i.clearChanges=function(){o()},i.importable=e.computed(function(){return i.sellerDealerId()!=null&&i.buyerDealerId()!=null&&i.buyerContactId()!=null&&i.bidAmount()>=1e3&&i.transportFee()>=0}),i.updateable=e.computed(function(){return i.bidAmount()>=1e3&&i.transportFee()>=0}),i.updateSale=function(e){s();if(!i.isDirty()){i.error("Nothing to update.");return}if(!i.updateable()){i.error("Fix your errors.");return}var t=$(e).formToJSON();$.ajax({url:r+"update",type:"POST",data:t,dataType:"json",success:function(e){e.success?(u(),i.success("Update Successful")):i.error("Update Not Successful")}})},i.importSale=function(){s();if(i.isImported){i.error("Already imported.");return}if(i.isDirty()){i.error("Update or clear your changes first.");return}if(!i.importable()){i.error("Fix your errors.");return}$.ajax({url:r+"import/"+i.eventId+"/"+i.transactionId,type:"POST",data:{},dataType:"json",success:function(e){e.success?(i.success("Import Successful"),i.isImported=!0):i.success("Import Not Successful")}})},a()}});